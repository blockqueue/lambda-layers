on:
  workflow_call:
    inputs:
      libName:
        description: The name of the library to install
        type: string
        required: true
      version:
        description: The version of the installed library
        type: string
        required: true
      archiveName:
        description: The name of the final archive
        type: string
        required: true
      dependencies:
        description: The name of the final archive
        type: string # a,b,c

jobs:
  BuildAndPublishAssets:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v4

      - name: Install Dependency
        run: npm install "${{ inputs.libName }}@${{ inputs.version }}"

      - name: Zip Asset
        run: |
          mkdir nodejs
          str_array=($(echo ${{ inputs.libName }} | tr "/" "\n"))
          initial=${str_array[0]}
          cp -r "node_modules/${initial}" nodejs/${initial}

          if [ -n "$dependencies" ]; then
            for dependency in $(echo $dependencies | tr "," "\n"); do
              cp -r "node_modules/${dependency}" nodejs/${dependency}
            done
          fi

          zip -r "${{ inputs.archiveName }}.zip" nodejs

      - name: Publish Assest to ${{ github.ref_name }}
        env:
          GITHUB_TOKEN: ${{ github.TOKEN }}
        run: |
          gh release upload ${{ github.ref_name }} "${{ inputs.archiveName }}.zip"
